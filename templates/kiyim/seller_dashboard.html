{% extends 'kiyim/base.html' %}
{% block title %}–î“Ø–∫–∞–Ω –î–∞—à–±–æ—Ä–¥—ã ‚Äî MODA{% endblock %}
{% block content %}
<div class="dashboard-layout">
    <div class="dashboard-sidebar">
        <div style="font-family:'Cormorant Garamond',serif;font-size:24px;color:var(--gold);letter-spacing:4px;margin-bottom:8px;">MODA</div>
        <div style="color:rgba(255,255,255,0.4);font-size:12px;margin-bottom:32px;letter-spacing:1px;">Sotuvchi –ø–∞–Ω–µ–ª–∏</div>
        <a href="{% url 'seller_dashboard' %}" class="dash-nav-item active"><span class="dash-nav-icon">üìä</span> –î–∞—à–±–æ—Ä–¥</a>
        <a href="{% url 'add_product' %}" class="dash-nav-item"><span class="dash-nav-icon">‚ûï</span> ”®–Ω–∏–º “ö–æ—Å—ã—û</a>
        <a href="{% url 'home' %}" class="dash-nav-item"><span class="dash-nav-icon">üè™</span> –î“Ø–∫–∞–Ω–¥—ã –ö”©—Ä–∏—û</a>
        <a href="{% url 'logout' %}" class="dash-nav-item" style="margin-top:auto;color:rgba(255,80,80,0.5);"><span class="dash-nav-icon">üö™</span> –®—ã“ì—ã—û</a>
    </div>
    <div class="dashboard-content">
        <div class="dash-header">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <div style="font-size:11px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;margin-bottom:8px;">üè™ {{ user.shop_name }}</div>
                    <h1 class="dash-title">–°–∞—Ç—ã—û –î–∞—à–±–æ—Ä–¥—ã</h1>
                    <p class="dash-subtitle">{{ user.get_full_name }} ‚Äî {{ user.phone }}</p>
                </div>
                <a href="{% url 'add_product' %}" class="btn btn-gold">+ ”®–Ω–∏–º “ö–æ—Å—ã—û</a>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">–ë–∞—Ä–ª—ã“õ ”®–Ω–∏–º–ª–µ—Ä</div><div class="stat-value">{{ product_count }}</div></div>
            <div class="stat-card"><div class="stat-label">–ë—É–π—Ä—ã—Ç–º–∞–ª–∞—Ä</div><div class="stat-value">{{ orders|length }}</div></div>
            <div class="stat-card"><div class="stat-label">–ñ–∞–ª–ø—ã –ö–∏—Ä–∏—Å</div><div class="stat-value" style="font-size:28px;">{{ total_revenue|floatformat:0 }}</div><div class="stat-unit">—Å—û–º</div></div>
            <div class="stat-card"><div class="stat-label">–î“Ø–∫–∞–Ω</div><div class="stat-value" style="font-size:20px;">{{ user.shop_name }}</div></div>
        </div>

        <!-- ”®–ù–ò–ú–õ–ï–† -->
        <div style="margin-bottom:48px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid var(--border);">
                <h2 style="font-family:'Cormorant Garamond',serif;font-size:28px;color:var(--dark);">–ú–µ–Ω—ñ“£ ”®–Ω–∏–º–ª–µ—Ä–∏–º</h2>
                <a href="{% url 'add_product' %}" class="btn btn-outline" style="padding:10px 24px;">+ –ñ–∞“£–∞</a>
            </div>
            {% if products %}
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;">
                {% for product in products %}
                <div style="background:var(--white);border:1px solid var(--border);overflow:hidden;transition:box-shadow 0.3s;" onmouseover="this.style.boxShadow='0 8px 32px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                    <div style="aspect-ratio:1/1;background:var(--cream);overflow:hidden;position:relative;">
                        {% if product.main_image %}<img src="{{ product.main_image.url }}" alt="{{ product.name }}" style="width:100%;height:100%;object-fit:cover;">
                        {% else %}<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:40px;">{% if product.category == 'ustki' %}üß•{% elif product.category == 'oyoq' %}üëü{% else %}üëó{% endif %}</div>{% endif %}
                        <div style="position:absolute;top:8px;right:8px;display:flex;gap:4px;">
                            <a href="{% url 'edit_product' product.pk %}" style="background:var(--white);padding:6px 10px;font-size:12px;text-decoration:none;color:var(--dark);border:1px solid var(--border);">‚úèÔ∏è</a>
                            <a href="{% url 'delete_product' product.pk %}" onclick="return confirm('”®–Ω–∏–º–¥–∏ ”©—à–∏—Ä–µ—Å–∏–∑ –±–µ?')" style="background:var(--error);padding:6px 10px;font-size:12px;text-decoration:none;color:white;">üóë</a>
                        </div>
                    </div>
                    <div style="padding:14px;">
                        <div style="font-size:10px;letter-spacing:2px;color:var(--text-muted);text-transform:uppercase;margin-bottom:4px;">{{ product.get_category_display }}</div>
                        <div style="font-family:'Cormorant Garamond',serif;font-size:18px;color:var(--dark);margin-bottom:8px;">{{ product.name }}</div>
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <span style="color:var(--gold);font-weight:500;">{{ product.price|floatformat:0 }} —Å—û–º</span>
                            {% if product.review_count %}<span style="font-size:11px;color:var(--text-muted);">‚≠ê {{ product.avg_rating|floatformat:1 }}</span>{% endif %}
                        </div>
                        <div style="margin-top:8px;display:flex;gap:4px;flex-wrap:wrap;">
                            {% for size in product.available_sizes %}<span style="border:1px solid var(--border);padding:2px 8px;font-size:11px;color:var(--text-muted);">{{ size.size }}</span>{% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align:center;padding:60px;border:1px dashed var(--border);">
                <div style="font-size:48px;margin-bottom:16px;">üì¶</div>
                <p style="color:var(--text-muted);margin-bottom:24px;">–°–∏–∑–¥–µ “≥”ô–∑–∏—Ä—à–µ ”©–Ω–∏–º –∂–æ“õ</p>
                <a href="{% url 'add_product' %}" class="btn btn-gold">–ë–∏—Ä–∏–Ω—à–∏ ”®–Ω–∏–º–¥–∏ “ö–æ—Å—ã—û</a>
            </div>
            {% endif %}
        </div>

        <!-- –ë–£–ô–†–´–¢–ú–ê–õ–ê–† -->
        {% if orders %}
        <div>
            <h2 style="font-family:'Cormorant Garamond',serif;font-size:28px;color:var(--dark);margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid var(--border);">–°–æ“£“ì—ã –ë—É–π—Ä—ã—Ç–º–∞–ª–∞—Ä</h2>
            <table class="data-table">
                <thead><tr><th>–ë—É–π—Ä—ã—Ç–º–∞</th><th>”®–Ω–∏–º</th><th>–†–∞–∑–º–µ—Ä</th><th>–°–∞–Ω—ã</th><th>–ë–∞“≥–∞—Å—ã</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ò—Å</th></tr></thead>
                <tbody>
                    {% for item in orders %}
                    <tr>
                        <td>#{{ item.order.pk }}</td>
                        <td>{{ item.product.name }}</td>
                        <td>{{ item.size }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.price|floatformat:0 }} —Å—û–º</td>
                        <td><span class="badge badge-{{ item.order.status }}">{{ item.order.get_status_display }}</span></td>
                        <td>
                            <form method="post" action="{% url 'update_order_status' item.pk %}" style="display:flex;gap:6px;">
                                {% csrf_token %}
                                <select name="status" style="font-size:12px;padding:4px 8px;border:1px solid var(--border);background:var(--white);">
                                    <option value="pending" {% if item.order.status == 'pending' %}selected{% endif %}>–ö“Ø—Ç–∏–ª–º–µ–∫—Ç–µ</option>
                                    <option value="accepted" {% if item.order.status == 'accepted' %}selected{% endif %}>“ö–∞–±—ã–ª –∞–ª—ã–Ω–¥—ã</option>
                                    <option value="shipped" {% if item.order.status == 'shipped' %}selected{% endif %}>–ñ–æ–ª–¥–∞</option>
                                    <option value="delivered" {% if item.order.status == 'delivered' %}selected{% endif %}>–ñ–µ—Ç–∫–µ—Ä–∏–ª–¥–∏</option>
                                    <option value="cancelled" {% if item.order.status == 'cancelled' %}selected{% endif %}>–ë–∞—Å —Ç–∞—Ä—Ç—ã–ª–¥—ã</option>
                                </select>
                                <button type="submit" style="padding:4px 10px;background:var(--gold);border:none;cursor:pointer;font-size:12px;">‚úì</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
